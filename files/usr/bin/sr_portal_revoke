#! /bin/bash

# Remove a user from the authenticated table if they aren't already in it.

case "$2" in
	"video"|"staff"|"compnet"|"management")
		found=`iptables -xvnL is_authenticated | egrep -i "MAC $1" | grep -E "${2}_access"`
		result=$?
		if [ $result -ne 0 ]; then
			exit 0
		fi
		iptables -D is_authenticated -m mac --mac-source "$1" -j ${2}_access
		;;
	"internet")
		found=`iptables -t nat -xvnL is_authenticated | egrep -i "MAC $1"`
		result=$?
		if [ $result -ne 0 ]; then
			exit 0
		fi
		iptables -t nat -D is_authenticated -m mac --mac-source "$1" -j ACCEPT
		iptables -D is_authenticated -m mac --mac-source "$1" -j internet_access
		;;
	"all")
		iptables -t nat -D is_authenticated -m mac --mac-source "$1"
		iptables -D is_authenticated -m mac --mac-source "$1"
		;;
esac
